<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


  <meta name="google-site-verification" content="Dd1Gsd473q8nk0HCu8DB8QFSlsWc2fNWJIaRuZMwMUQ" />





  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.2"/>




  <meta name="keywords" content="Unity3D,地图,随机," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.2" />



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?2cace313a881340a6ccc899ac3fcf4b2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <title> （原创）为Unity3D游戏生成2D和3D多边形随机地图(2/3) // Ivan.Z </title>
</head>

<body>
<!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Ivan.Z</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
     
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首頁
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分類
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          關於
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          歸檔
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          標籤
        </a>
      </li>
    
      
      <li class="menu-item menu-item-commonweal">
        <a href="/404.html">
          <i class="menu-item-icon icon-commonweal"></i> <br />
          公益404
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              （原创）为Unity3D游戏生成2D和3D多边形随机地图(2/3)
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2015-06-11
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分類於
            
              <a href="/categories/翻译/">翻译</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/06/11/为游戏生成多边形地图-2-3/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/06/11/为游戏生成多边形地图-2-3/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <blockquote><p>原版Demo，稍后会放出改进版的Unity版本</p>
<footer><strong>Ivan.Z</strong><cite><a href="http://www-cs-students.stanford.edu/~amitp/game-programming/polygon-map-generation/demo.html" target="_blank" rel="external">官方Demo</a></cite></footer></blockquote>
<h2 id="Rivers_河流">Rivers 河流</h2><p>Rivers and lakes are the two fresh water features I wanted. The most realistic approach would be to define moisture with wind, clouds, humidity, and rainfall, and then define the rivers and lakes based on where it rains. Instead, I’m starting with the goal, which is good rivers, and working backwards from there.<br>我想要地图里包含河流和湖泊。最通用的办法是先定义一个包含风，云，湿度和降雨的湿度图，然后在这个基础上定义河流和湖泊。相反，我先设定好地图上的河流，然后从这里倒退计算。</p>
<p>The island shape determines which areas are water and which are land. Lakes are water polygons that aren’t oceans.<br>岛屿的形状决定了哪些区域是水哪些是陆地。标记为水的多边形除了海洋就是湖泊。</p>
<p>Rivers use the downhill directions shown earlier. I choose random corner locations in the mountains, and then follow the Corner.downslope path down to the ocean. The rivers flow from corner to corner:<br>如前所示，河流使用了下坡的方向。我选择山峰的一个随机角落，然后按照Corner.downslope方向一路走向海洋。河流从一个角落流向另一个角落：<br><img src="/2015/06/11/为游戏生成多边形地图-2-3/river.png" alt="river.png" title=""></p>
<p>I tried both polygon centers and corners, but found that the corner graph made for much nicer looking rivers. Also, by keeping lakes flat, elevation tends to be lower near lakes, so rivers naturally flow into and out of lakes. Multiple rivers can share the lower portion of their path. Every time a river flows through an edge, I increase the water volume stored in Edge.river by 1. At rendering time, the river width is the square root of the volume. This approach is simple and works well.<br>我分别尝试过使用多边形的中心和角落来计算河流，最后发现还是角落的图集生成的河流更好看。此外，通过保持湖泊的平坦，靠近湖泊的海拔自然趋向更低，所以河流很自然的流入和流出湖泊。多个河流可以共享它们的部分下游路径。每当一条河流经过一条边缘，我就会将存储在Edge.river 变量里的水量加1。这样在渲染的时候，河流的宽度就是水量的平方了。这种方既简单效果又好。</p>
<h2 id="Moisture_湿度图">Moisture 湿度图</h2><p>Since I’m working backwards, I don’t need moisture to form rivers. However, moisture would be useful for defining biomes (deserts, swamps, forests, etc.). Since rivers and lakes should form in areas with high moisture, I defined moisture to decrease as distance from fresh water increases. Corner.moisture is set to a^k for some a &lt; 1 (e.g. 0.95), and k being the distance. There are unfortunately some tuning parameters in Map.assignCornerMoisture that I tweaked until the maps looked reasonable:<br>由于我是逆向工作的，所以不需要一个湿度图来生成河流。然而，湿度图对于定义生物群落 还是很有用的（比如沙漠，沼泽，森林等）。由于河流和湖泊要从高湿度的区域发起，我定义湿度的规则为随着远离淡水则降低水分 。Corner.moisture被设定为a^k（a的k次方），注意a永远&lt;1 （例如0.95），并且k作为远离淡水的距离。不幸的是我需要手动调整Map.assignCornerMoisture 参数，直到地图看起来合理为止。</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/moisture.png" alt="moisture.png" title="">
<p>As with elevation, I redistribute moisture to match a desired distribution. In this case, I want roughly equal numbers of dry and wet regions. The desired cumulative distribution is y(x) = x, so the redistribution code is very simple. I sort by moisture and then assign the moisture of each corner to that corner’s position in the sorted list. See Map.redistributeMoisture for the code.<br>和海拔一样，我重新分配了湿度直到符合期望的分布。在这种情况下，我希望干旱和湿润地区大致相等。所需的累积分布函数是y(x) = x ，所以分配代码是很简单的。我先按照湿度排序角落，然后按照每个角落在排序里的顺序分配湿度。查看代码里的Map.redistributeMoisture一值。</p>
<p>In this map generator, moisture is only used for biomes. However, games may find other uses for the moisture data. For example, Realm of the Mad God uses moisture and elevation to distribute vegetation and monsters.<br>在这个地图生成器里，湿度只用来处理生物群落。然而，游戏可能会将之用在其他的地方。例如，  Realm of the Mad God采用水分和海拔来分布植被和怪物。</p>
<h2 id="Biomes_生物群落">Biomes 生物群落</h2><p>Together, elevation and moisture provide a good amount of variety to define biome types. I use elevation as a proxy for temperature. If this were a continent generator, latitude might be a contributor to temperature. Also, wind, evaporation, and rain shadows might be useful for transporting moisture as humidity. However, for this generator I kept it simple. Biomes first depend on whether it’s water or land:<br>总之，海拔和湿度提供了足够的多样性来定义生物类型。我使用海拔来代理温度。如果这是一个大陆生成器，纬度可能是影响温度的主要贡献者。此外，风，水分蒸发和雨影区也会导致湿度的转移。不过，我保持了这个算法的简洁。生物群落首先依赖于地形是水面还是陆地。</p>
<ul>
<li>OCEAN is any water polygon connected to the map border</li>
<li>LAKE is any water polygon not connected to the map border, or ICE lake if the lake is at high elevation (low temperature), or MARSH if it’s at low elevation </li>
<li>BEACH is any land polygon next to an ocean</li>
<li>OCEAN是任何接触到地图边缘的水多边形。</li>
<li>湖泊是任何没有连接到地图边界的水多边形，或者冰湖则是高海拔且低温度的湖泊，沼泽 则是低海拔的湖泊。</li>
<li>海滩则是毗邻海洋的土地多边形</li>
</ul>
<p>For all land polygons, I started with the Whittaker diagram and adapted it to my needs:<br>对于所有的土地多边形，我开始用Whittaker diagram算法来处理，并将之修改为适应我的需求：</p>
<p>Elevation Zone                    Moisture Zone</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:right">6(wet)</th>
<th style="text-align:right">5</th>
<th style="text-align:right">4</th>
<th style="text-align:right">3</th>
<th style="text-align:right">2</th>
<th style="text-align:right">1(dry)</th>
</tr>
</thead>
<tbody>
<tr>
<td>4(high)</td>
<td style="text-align:right">SNOW</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right">TUNDRA</td>
<td style="text-align:right">BARE</td>
<td style="text-align:right">SCORCHED</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:right">TAIGA</td>
<td style="text-align:right"></td>
<td style="text-align:right">SHRUBLAND</td>
<td style="text-align:right"></td>
<td style="text-align:right">TEMPERATE DESERT</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td>2</td>
<td style="text-align:right">TEMPERATE RAIN FOREST</td>
<td style="text-align:right">TEMPERATE DECIDUOUS FOREST</td>
<td style="text-align:right"></td>
<td style="text-align:right">GRASSLAND</td>
<td style="text-align:right"></td>
<td style="text-align:right">TEMPERATE DESERT</td>
</tr>
<tr>
<td>1(low)</td>
<td style="text-align:right">TROPICAL RAIN FOREST</td>
<td style="text-align:right"></td>
<td style="text-align:right">TROPICAL SEASONAL FOREST</td>
<td style="text-align:right"></td>
<td style="text-align:right">GRASSLAND</td>
<td style="text-align:right">SUBTROPICAL DESERT</td>
</tr>
</tbody>
</table>
<p>海拔区                    湿度区</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:right">6(湿)</th>
<th style="text-align:right">5</th>
<th style="text-align:right">4</th>
<th style="text-align:right">3</th>
<th style="text-align:right">2</th>
<th style="text-align:right">1（干）</th>
</tr>
</thead>
<tbody>
<tr>
<td>4(高)</td>
<td style="text-align:right">雪地</td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right">冻土</td>
<td style="text-align:right">荒原</td>
<td style="text-align:right">焦土</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:right">针叶林</td>
<td style="text-align:right"></td>
<td style="text-align:right">灌木丛</td>
<td style="text-align:right"></td>
<td style="text-align:right">温带荒漠</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td>2</td>
<td style="text-align:right">温带雨林</td>
<td style="text-align:right">温带落叶林</td>
<td style="text-align:right"></td>
<td style="text-align:right">草原</td>
<td style="text-align:right"></td>
<td style="text-align:right">温带荒漠</td>
</tr>
<tr>
<td>1(低)</td>
<td style="text-align:right">热带雨林</td>
<td style="text-align:right"></td>
<td style="text-align:right">热带季雨林</td>
<td style="text-align:right"></td>
<td style="text-align:right">草原</td>
<td style="text-align:right">亚热带沙漠</td>
</tr>
</tbody>
</table>
<p>Here’s the result:<br>这里是结果：</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/biomes.png" alt="biomes.png" title="">
<p>These biomes look good in the map generation demo, but each game will have its own needs. Realm of the Mad God for example ignores these biomes and uses its own (based on elevation and moisture).<br>这些生物群落在这个地图生成器demo里看起来不错，但每个游戏都会有自己独特的需求。以 Realm of the Mad God为例，它忽略了这些生物群落，并使用它自己的算法（基于海拔和湿度）。</p>
<h2 id="Noisy_Edges_噪声化边缘">Noisy Edges 噪声化边缘</h2><p>For some games, the polygonal maps are sufficient. However, in other games I want to hide the polygon structure. The main way I do that is to replace the polygon borders with a noisy line. Why would I want a polygon structure if I’m just going to hide it? I think game mechanics and pathfinding benefit from the underlying structure.<br>对于一些游戏，多边形地图就足够了。但是，在其他游​​戏里我想要隐藏多边形结构。我所用的方法是用扰乱的线条来替换多边形边界。如果我想要隐藏它为什么我还想要多边形结构。那是因为我认为游戏机制和寻路将会受益于这个底层结构。</p>
<p>Recall from earlier that there are two graphs: one for Voronoi corners (1, 2 in the diagram below) and edges (blue lines), and one for polycon centers (A, B) and Delaunay edges (red lines) between them:<br>回想一下开始的时候，我们有两个图形：一个用于Voronoi 拐角（ 下图中的1 ， 2）和边缘（蓝线），还有一个用于多边形中心（ A ， B ），和他们之间的Delaunay 边缘（红色线）：</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/edge-duality.png" alt="edge-duality.png" title="">
<p>I wanted to make both types of line noisy without making them cross lines from other polygons. I also wanted to make them as noisy as feasible. I realized that points A, 1, B, and 2 form a quadrilateral, and I could constrain the wanderings of the line segment to that quadrilateral:<br>我想扰乱这两种类型的边缘，但又不想让他们再次相交。并且需要确保他们是可以被扰乱的。我意识到点A ， 1 ， B ，和2形成了一个四边形，我可以将扰乱后的线条片段约束在这个四边形内：</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/edge-noisiness.png" alt="edge-noisiness.png" title="">
<p>I further divided the quadrilateral into four quadrilaterals. Two were usable for the red (Delaunay) edge and two for the blue (Voronoi) edge. As long as the lines stayed within their allocated space and met in the center, they’d never cross each other. That takes care of constraining them. Note that the quadrilateral may not be convex; to divide it properly, I divide it at the midpoint of the Voronoi edge instead of at the intersection of the Voronoi and Delaunay edges.<br>我进一步将四边形分成四个四边形。两个用于红色（Delaunay）的边缘，还有两个用于蓝色（Voronoi）边。只要这些线段待在分配给他们的空间里，并且只在中心相交，那他们就永远不会互相相交。这需要谨慎制约他们。需要注意的是四边形未必是凸多边形;为了正确地将其划分，我从Voronoi 边的中点开始拆分而不是在Voronoi 和Delaunay 边的交叉点。</p>
<p>The entire map can be divided up into these quadrilateral regions, with no space left over:<br>整个地图可以全部被划分成四边形区域，无一遗漏：</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/quad-markings.png" alt="quad-markings.png" title="">
<p>That ensures that the noisy lines aren’t constrained any more than necessary. (I wonder if these quadrilaterals would be useful for game mechanics.)<br>这保证了扰乱线段除了必须的限制不会有更多要求了。（我不知道这些四边形对于游戏机制是否有用。）</p>
<p>I can use any noisy line algorithm that fits within these constraints. I decided to subdivide the quadrilaterals recursively and stitch line segments together within the small quadrilaterals into a complete edge. The algorithm is in NoisyEdges.as, in buildNoisyLineSegments. The result is that the polygon edges are no longer straight:<br>我可以使用任何噪声算法，只要保证它们在约束内即可。我决定递归细分四边形和并将小四边形内的线段连成一个完整的边缘。该算法代码包含在NoisyEdges.as 的buildNoisyLineSegments 函数里。最终的结果是多边形的边缘不再笔直。</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/biomes-noisy.png" alt="biomes-noisy.png" title="">
<p>There are three places to tune the noisiness:<br>有三个地方需要调整设置：</p>
<ol>
<li>The recursive function ends when the segments are shorter than some length. I have examples at segment size 7, segment size 4, and segment size 1. In the map demo I use segment size 1 for rivers and coastlines, 3 where biomes meet, and 10 elsewhere.</li>
<li>当片段小于预定的值时，递归函数将会结束。这里有一些例子，分别是片段大小为7 ， 片段大小为4 ，和片段大小为1 。在地图的demo里，我将河流和海岸线的片段值设为1，生物群落的片段值设为3，剩下的都设为10。</li>
<li>There’s a tradeoff between how much of the space goes to the red quadrilaterals (Delaunay edges) and blue quadrilaterals (Voronoi edges). I set NoisyEdges.NOISY_LINE_TRADEOFF to 0.5.</li>
<li>还需要权衡有多少空间属于红色四边形（Delaunay边）和蓝色四边形（Voronoi边）。我将 NoisyEdges.NOISY_LINE_TRADEOFF设置为0.5。</li>
<li>There’s a range of random numbers in NoisyEdges.subdivide. In the current demo it’s from 0.2-0.8, but it can be up to 0.0–1.0. Also, the random numbers don’t have to be linearly chosen. More visual noise results if you avoid the space around 0.5.</li>
<li>在NoisyEdges.subdivide 函数里有一个随机数范围。在当前的demo里是从0.2-0.8，但它可以设置为0.0-1.0。另外，随机数不必按照线性选择。如果您避免在空间被平均划分，就会获得更加噪声化的视觉结果。</li>
</ol>
<p>Noisy edges turn out to have a large impact on the map appearance, especially for rivers and coastlines.<br>噪声化后的边缘对地图的外观有很大的影响，特别是对河流和海岸线。</p>
<h2 id="More_noise_更多的噪声">More noise 更多的噪声</h2><p>I’m generally a fan of noise in game art, and wanted to add a little bit of noise to these maps as well. In a real game map the noise might reflect vegetation or small variations in terrain. In the demo (mapgen2.as) I just filled the screen with a random noise texture by adding a noise bitmap on top. I also smoothed the borders between adjacent polygons by blending the colors in stages:<br>通常我都是推崇在游戏美术里添加噪声 ，但希望只添加一点点噪声到这些地图为好。在一个真正的游戏地图中,噪声可以用于反映植被或地形的微小变化。在演示（ mapgen2.as ）里，我只是用一个随机噪声贴图来填充屏幕。我还通过混合相邻多边形边缘的颜色来平滑边界。</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/voronoi-map-goal.png" alt="voronoi-map-goal.png" title="">
<p>Here’s a rendering with 16,000 polygons, noisy edges, a noise texture overlay, and simple lighting:<br>这个渲染示例拥有16000个多边形，并噪声化边缘，噪声纹理覆盖，以及简单的灯光：</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/voronoi-map-goal-16000-shaded.png" alt="voronoi-map-goal-16000-shaded.png" title="">
<h2 id="Smooth_biome_transitions_平滑生物群落的过度">Smooth biome transitions 平滑生物群落的过度</h2><p>A different way of blending the biomes at polygon boundaries is to build gradients using the elevation and moisture at each corner, and then assigning biomes per pixel:<br>还有一种混合多边形边界的生物群落的方式，就是使用海拔和湿度在各个角落创建一个渐变 ，然后分配给每个像素分配生物群落值。</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/voronoi-map-goal-smooth.png" alt="voronoi-map-goal-smooth.png" title="">
<p>If the game doesn’t need an entire polygon to be the same biome, this approach can be useful for making more interesting boundaries.<br>如果游戏不需要整个多边形都是相同的生物群落，那这种方法可用于制造更有趣的边界。</p>
<h2 id="Distorted_biome_transitions_扭曲生物群落的过度">Distorted biome transitions 扭曲生物群落的过度</h2><p>Another way to make the map look less polygon-like is to distort the elevation and moisture maps:<br>还有一种使地图看起来不像多边形的方式就是扭曲海拔和湿度图。</p>
<ol>
<li>Add Perlin or random noise to the elevation and moisture at each pixel.</li>
<li>Sample nearby points using Perlin or random noise to change the coordinate.</li>
<li>添加Perlin或随机噪声函数到海拔和湿度图的每个像素。</li>
<li>使用培林或随机噪声函数在坐标附近采样</li>
</ol>
<p>Here’s an example of what this can do:<br>下面这个示例展示了可以做到什么效果：</p>
<img src="/2015/06/11/为游戏生成多边形地图-2-3/voronoi-map-goal-distorted.png" alt="voronoi-map-goal-distorted.png" title="">
<p>Adding noise to the elevation and moisture will produce “dithering” in the zones near transitions. Sampling nearby points using noise will distort the shapes of the boundaries.<br>将噪声添加到海拔和湿度图会导致在区域过度附近产生“抖动”。使用噪声在坐标附近采样会扭曲形状的边缘。</p>

      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Unity3D/"> #Unity3D </a>
          
            <a href="/tags/地图/"> #地图 </a>
          
            <a href="/tags/随机/"> #随机 </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/06/24/为游戏生成多边形地图-3-3/">（原创）为Unity3D游戏生成2D和3D多边形随机地图(3/3)</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/06/01/为游戏生成多边形地图-1-3/">（原创）为Unity3D游戏生成2D和3D多边形随机地图(1/3)</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="comments" id="comments">
        
          <div class="ds-thread" data-thread-key="2015/06/11/为游戏生成多边形地图-2-3/"
               data-title="（原创）为Unity3D游戏生成2D和3D多边形随机地图(2/3)" data-url="http://ivanz.info/2015/06/11/为游戏生成多边形地图-2-3/">
          </div>
        
      </div>
    
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/author.jpg" alt="ivan.z" />
          <p class="site-author-name">ivan.z</p>
        </div>
        <p class="site-description motion-element"></p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/losetear" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.weibo.com/losetear" target="_blank">Weibo</a>
            </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Rivers_河流"><span class="nav-number">1.</span> <span class="nav-text">Rivers 河流</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Moisture_湿度图"><span class="nav-number">2.</span> <span class="nav-text">Moisture 湿度图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Biomes_生物群落"><span class="nav-number">3.</span> <span class="nav-text">Biomes 生物群落</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Noisy_Edges_噪声化边缘"><span class="nav-number">4.</span> <span class="nav-text">Noisy Edges 噪声化边缘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More_noise_更多的噪声"><span class="nav-number">5.</span> <span class="nav-text">More noise 更多的噪声</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Smooth_biome_transitions_平滑生物群落的过度"><span class="nav-number">6.</span> <span class="nav-text">Smooth biome transitions 平滑生物群落的过度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Distorted_biome_transitions_扭曲生物群落的过度"><span class="nav-number">7.</span> <span class="nav-text">Distorted biome transitions 扭曲生物群落的过度</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2013 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">ivan.z</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.content img').each(function () {
        var $image = $(this);
        var $imageWrapLink = $image.parent('a');

        if ($imageWrapLink.size() < 1) {
          $imageWrapLink = $image.wrap('<a href="' + this.getAttribute('src') + '"></a>').parent('a');
        }
        $imageWrapLink.addClass('fancybox');
      });
    });
    $('.fancybox').fancybox({
      helpers: {
        overlay: {
          locked: false
        }
      }
    });
  </script>


  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }

  function displaySidebar () {
    setTimeout(function () {
      $('.sidebar-toggle').trigger('click');
    }, 800);
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebarToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebarToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      if (isDesktop() && HEXO_SIDEBAR_CONFIGURATION === 'post') {
        displaySidebar();
      }
    });
  </script>




  <script type="text/javascript">
    var HEXO_SIDEBAR_CONFIGURATION = 'post';
    $(document).ready(function () {
      if (HEXO_SIDEBAR_CONFIGURATION === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ivanz"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


  
  
  <script type="text/javascript">
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-63181758-1');ga('send','pageview');
  </script>

</body>
</html>
